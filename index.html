<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MathGPT - Intelligent Mathematics Learning</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary: #6366F1;
            --primary-dark: #4F46E5;
            --secondary: #EC4899;
            --background: #F8FAFC;
            --surface: #FFFFFF;
            --text-primary: #1F2937;
            --text-secondary: #6B7280;
            --border: #E5E7EB;
            --success: #10B981;
            --warning: #F59E0B;
            --error: #EF4444;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #667EEA 0%, #764BA2 100%);
            min-height: 100vh;
            color: var(--text-primary);
        }
        
        /* Login Screen */
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667EEA 0%, #764BA2 100%);
            z-index: 1000;
        }
        
        .login-container {
            background: white;
            padding: 2.5rem;
            border-radius: 1rem;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            width: 90%;
            max-width: 400px;
        }
        
        .login-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .login-subtitle {
            color: var(--text-secondary);
            margin-bottom: 2rem;
        }
        
        .login-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .form-input {
            padding: 0.75rem 1rem;
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(99, 102, 241, 0.3);
        }
        
        .btn-secondary {
            background: white;
            border: 1px solid var(--border);
            color: var(--text-primary);
        }
        
        .btn-secondary:hover {
            border-color: var(--primary);
        }
        
        .form-toggle {
            text-align: center;
            margin-top: 1rem;
            color: var(--text-secondary);
        }
        
        .form-toggle a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
            cursor: pointer;
        }
        
        /* Main App */
        .app-container {
            display: none;
            height: 100vh;
            overflow: hidden;
        }
        
        .sidebar {
            width: 300px;
            background: white;
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        
        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
        }
        
        .sidebar-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .new-chat-btn {
            width: 100%;
            margin-top: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            justify-content: center;
        }
        
        .chat-history {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }
        
        .chat-item {
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .chat-item:hover {
            background: var(--background);
        }
        
        .chat-item.active {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(236, 72, 153, 0.1) 100%);
            border: 1px solid var(--primary);
        }
        
        .chat-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        
        .chat-date {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--background);
        }
        
        .header {
            padding: 1rem 2rem;
            background: white;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 2rem;
            max-width: 800px;
            margin: 0 auto;
            width: 100%;
        }
        
        .message {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: white;
            border-radius: 1rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        
        .message-user {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.05) 0%, rgba(236, 72, 153, 0.05) 100%);
        }
        
        .message-ai {
            background: white;
        }
        
        .question-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
        }
        
        .question-number {
            width: 2rem;
            height: 2rem;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
        }
        
        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .status-correct {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }
        
        .status-partial {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }
        
        .status-incorrect {
            background: rgba(239, 68, 68, 0.1);
            color: var(--error);
        }
        
        .solution-section {
            margin-top: 1rem;
        }
        
        .solution-section h4 {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
        }
        
        .solution-content {
            padding: 1rem;
            background: var(--background);
            border-radius: 0.5rem;
            border-left: 3px solid var(--primary);
        }
        
        /* Input Area */
        .input-area {
            padding: 1rem 2rem;
            background: white;
            border-top: 1px solid var(--border);
        }
        
        .input-container {
            max-width: 800px;
            margin: 0 auto;
            display: flex;
            gap: 1rem;
        }
        
        .file-input-wrapper {
            position: relative;
        }
        
        .file-input {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }
        
        .file-label {
            padding: 0.75rem 1.5rem;
            background: var(--background);
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
        }
        
        .analyze-btn {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
            flex-wrap: wrap;
        }
        
        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 1rem;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }
        
        .corrected-image {
            width: 100%;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            border: 2px solid var(--error);
        }
        
        /* Loading */
        .loading {
            display: inline-block;
            width: 1.5rem;
            height: 1.5rem;
            border: 3px solid #f3f4f6;
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                position: absolute;
                left: -100%;
                transition: left 0.3s;
                z-index: 100;
            }
            
            .sidebar.active {
                left: 0;
            }
            
            .mobile-menu-btn {
                display: block;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div class="login-screen" id="loginScreen">
        <div class="login-container">
            <h1 class="login-title">MathGPT‚ôæÔ∏è‚à´</h1>
            <p class="login-subtitle">Where Math meets AI</p>
            
            <form class="login-form" id="loginForm">
                <input type="text" class="form-input" id="username" placeholder="Username" required>
                <input type="password" class="form-input" id="password" placeholder="Password" required>
                <button type="submit" class="btn btn-primary" id="loginBtn">Login</button>
            </form>
            
            <div class="form-toggle">
                Don't have an account? <a id="showRegister">Register</a>
            </div>
        </div>
    </div>
    
    <!-- Register Screen -->
    <div class="login-screen" id="registerScreen" style="display: none;">
        <div class="login-container">
            <h1 class="login-title">Create Account</h1>
            <p class="login-subtitle">Join MathGPT community</p>
            
            <form class="login-form" id="registerForm">
                <input type="text" class="form-input" id="regUsername" placeholder="Username" required>
                <input type="password" class="form-input" id="regPassword" placeholder="Password" required>
                <input type="password" class="form-input" id="regConfirm" placeholder="Confirm Password" required>
                <button type="submit" class="btn btn-primary" id="registerBtn">Register</button>
            </form>
            
            <div class="form-toggle">
                Already have an account? <a id="showLogin">Login</a>
            </div>
        </div>
    </div>
    
    <!-- Main App -->
    <div class="app-container" id="appContainer">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2 class="sidebar-title">üìö MathGPT</h2>
                <button class="btn btn-primary new-chat-btn" onclick="newChat()">
                    + New Analysis
                </button>
            </div>
            
            <div class="chat-history" id="chatHistory">
                <!-- Chat history will be loaded here -->
            </div>
            
            <div class="sidebar-header">
                <button class="btn btn-secondary" onclick="logout()" style="width: 100%;">
                    Logout
                </button>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="main-content">
            <div class="header">
                <button class="btn btn-secondary mobile-menu-btn" onclick="toggleSidebar()">
                    ‚ò∞
                </button>
                <div class="user-info">
                    <span>Welcome, <strong id="currentUser"></strong></span>
                </div>
            </div>
            
            <!-- Chat Messages -->
            <div class="chat-container" id="chatContainer">
                <div class="message message-ai">
                    <h3>Welcome to MathGPT! üéì</h3>
                    <p>Upload your math answer sheets (PDF, JPG, PNG) and get instant analysis with error detection.</p>
                    <p>Features:</p>
                    <ul>
                        <li>‚úÖ Automatic error detection</li>
                        <li>üìê Bounding boxes on mistakes</li>
                        <li>üìù Step-by-step corrections</li>
                        <li>üìä Practice paper generation</li>
                    </ul>
                </div>
            </div>
            
            <!-- Input Area -->
            <div class="input-area">
                <div class="input-container">
                    <div class="file-input-wrapper">
                        <input type="file" class="file-input" id="fileInput" multiple accept=".pdf,.jpg,.jpeg,.png">
                        <label class="file-label">
                            üìé Attach Files
                        </label>
                    </div>
                    <button class="btn btn-primary analyze-btn" onclick="startAnalysis()" id="analyzeBtn">
                        Analyze
                    </button>
                </div>
                <div id="fileList" style="margin-top: 0.5rem; font-size: 0.875rem; color: var(--text-secondary);"></div>
            </div>
        </div>
    </div>
    
    <!-- Corrected Paper Modal -->
    <div class="modal" id="correctedModal">
        <div class="modal-content">
            <h3 class="modal-header">üìê Corrected Paper</h3>
            <div id="correctedImages"></div>
            <button class="btn btn-secondary" onclick="closeModal()" style="width: 100%; margin-top: 1rem;">
                Close
            </button>
        </div>
    </div>
    
    <!-- Practice Paper Modal -->
    <div class="modal" id="practiceModal">
        <div class="modal-content">
            <h3 class="modal-header">üìù Practice Paper</h3>
            <div id="practiceContent"></div>
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="downloadPractice()">
                    Download PDF
                </button>
                <button class="btn btn-secondary" onclick="closeModal()">
                    Close
                </button>
            </div>
        </div>
    </div>
    
    <script>
        const BACKEND_URL = 'https://navalsheth.pythonanywhere.com';
        let currentUser = null;
        let currentChatId = null;
        let uploadedFiles = [];
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            checkAuth();
            setupEventListeners();
        });
        
        // Event Listeners
        function setupEventListeners() {
            // Login/Register forms
            document.getElementById('loginForm').addEventListener('submit', (e) => {
                e.preventDefault();
                login();
            });
            
            document.getElementById('registerForm').addEventListener('submit', (e) => {
                e.preventDefault();
                register();
            });
            
            // Toggle forms
            document.getElementById('showRegister').addEventListener('click', () => {
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('registerScreen').style.display = 'flex';
            });
            
            document.getElementById('showLogin').addEventListener('click', () => {
                document.getElementById('registerScreen').style.display = 'none';
                document.getElementById('loginScreen').style.display = 'flex';
            });
            
            // File input
            document.getElementById('fileInput').addEventListener('change', (e) => {
                uploadedFiles = Array.from(e.target.files);
                updateFileList();
            });
        }
        
        // Auth Functions
        async function checkAuth() {
            try {
                const response = await fetch(`${BACKEND_URL}/api/check-auth`, {
                    credentials: 'include'
                });
                const data = await response.json();
                
                if (data.authenticated) {
                    currentUser = data.user;
                    showApp();
                    loadChats();
                } else {
                    showLogin();
                }
            } catch (error) {
                console.error('Auth check failed:', error);
                showLogin();
            }
        }
        
        async function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const btn = document.getElementById('loginBtn');
            
            btn.innerHTML = '<div class="loading"></div>';
            btn.disabled = true;
            
            try {
                const response = await fetch(`${BACKEND_URL}/api/login`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({username, password}),
                    credentials: 'include'
                });
                
                const data = await response.json();
                
                if (data.success) {
                    currentUser = data.user;
                    showApp();
                    loadChats();
                } else {
                    alert(data.message);
                }
            } catch (error) {
                alert('Login failed');
            } finally {
                btn.innerHTML = 'Login';
                btn.disabled = false;
            }
        }
        
        async function register() {
            const username = document.getElementById('regUsername').value;
            const password = document.getElementById('regPassword').value;
            const confirm = document.getElementById('regConfirm').value;
            
            if (password !== confirm) {
                alert('Passwords do not match');
                return;
            }
            
            const btn = document.getElementById('registerBtn');
            btn.innerHTML = '<div class="loading"></div>';
            btn.disabled = true;
            
            try {
                const response = await fetch(`${BACKEND_URL}/api/register`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({username, password}),
                    credentials: 'include'
                });
                
                const data = await response.json();
                
                if (data.success) {
                    currentUser = data.user;
                    showApp();
                    loadChats();
                } else {
                    alert(data.message);
                }
            } catch (error) {
                alert('Registration failed');
            } finally {
                btn.innerHTML = 'Register';
                btn.disabled = false;
            }
        }
        
        async function logout() {
            try {
                await fetch(`${BACKEND_URL}/api/logout`, {
                    method: 'POST',
                    credentials: 'include'
                });
            } catch (error) {
                // Ignore errors
            }
            
            currentUser = null;
            showLogin();
        }
        
        // UI Functions
        function showLogin() {
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('registerScreen').style.display = 'none';
            document.getElementById('appContainer').style.display = 'none';
        }
        
        function showApp() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('registerScreen').style.display = 'none';
            document.getElementById('appContainer').style.display = 'flex';
            document.getElementById('currentUser').textContent = currentUser.username;
        }
        
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('active');
        }
        
        // File Functions
        function updateFileList() {
            const fileList = document.getElementById('fileList');
            if (uploadedFiles.length === 0) {
                fileList.textContent = 'No files selected';
                return;
            }
            
            fileList.textContent = `Selected: ${uploadedFiles.map(f => f.name).join(', ')}`;
        }
        
        // Chat Functions
        async function loadChats() {
            try {
                const response = await fetch(`${BACKEND_URL}/api/chats`, {
                    credentials: 'include'
                });
                const data = await response.json();
                renderChats(data.chats);
            } catch (error) {
                console.error('Failed to load chats:', error);
            }
        }
        
        function renderChats(chats) {
            const container = document.getElementById('chatHistory');
            container.innerHTML = '';
            
            chats.forEach(chat => {
                const div = document.createElement('div');
                div.className = 'chat-item';
                div.onclick = () => loadChat(chat.id);
                div.innerHTML = `
                    <div class="chat-title">${chat.title}</div>
                    <div class="chat-date">${new Date(chat.date).toLocaleDateString()}</div>
                `;
                container.appendChild(div);
            });
        }
        
        async function loadChat(chatId) {
            try {
                const response = await fetch(`${BACKEND_URL}/api/chat/${chatId}`, {
                    credentials: 'include'
                });
                const data = await response.json();
                
                currentChatId = chatId;
                displayAnalysis(data);
                
                // Update active state
                document.querySelectorAll('.chat-item').forEach(item => {
                    item.classList.remove('active');
                });
                event.target.classList.add('active');
                
                toggleSidebar(); // Close sidebar on mobile
            } catch (error) {
                console.error('Failed to load chat:', error);
            }
        }
        
        function newChat() {
            currentChatId = null;
            document.getElementById('chatContainer').innerHTML = `
                <div class="message message-ai">
                    <h3>Welcome to MathGPT! üéì</h3>
                    <p>Upload your math answer sheets (PDF, JPG, PNG) and get instant analysis.</p>
                </div>
            `;
            
            // Clear active state
            document.querySelectorAll('.chat-item').forEach(item => {
                item.classList.remove('active');
            });
            
            toggleSidebar();
        }
        
        // Main Analysis
        async function startAnalysis() {
            if (uploadedFiles.length === 0) {
                alert('Please select files first');
                return;
            }
            
            const btn = document.getElementById('analyzeBtn');
            btn.innerHTML = '<div class="loading"></div> Analyzing...';
            btn.disabled = true;
            
            const formData = new FormData();
            uploadedFiles.forEach(file => {
                formData.append('files', file);
            });
            
            try {
                const response = await fetch(`${BACKEND_URL}/api/analyze`, {
                    method: 'POST',
                    body: formData,
                    credentials: 'include'
                });
                
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                // Display results
                displayAnalysis(data);
                
                // Save chat ID
                currentChatId = data.chat_id;
                
                // Reload chats
                loadChats();
                
            } catch (error) {
                alert('Analysis failed: ' + error.message);
            } finally {
                btn.innerHTML = 'Analyze';
                btn.disabled = false;
                uploadedFiles = [];
                updateFileList();
            }
        }
        
        function displayAnalysis(data) {
            const container = document.getElementById('chatContainer');
            let html = '';
            
            // User message
            html += `<div class="message message-user">
                <p>üìé Uploaded ${data.questions?.length || 0} questions for analysis</p>
            </div>`;
            
            // AI response with questions
            html += '<div class="message message-ai">';
            html += '<h3>Analysis Results</h3>';
            
            if (data.questions && data.questions.length > 0) {
                data.questions.forEach((q, idx) => {
                    const statusClass = q.correct === 'yes' ? 'correct' : 
                                     q.correct === 'partial' ? 'partial' : 'incorrect';
                    const statusText = q.correct === 'yes' ? 'Correct' : 
                                     q.correct === 'partial' ? 'Partial' : 'Needs Correction';
                    
                    html += `
                        <div class="question" style="margin-bottom: 2rem;">
                            <div class="question-header">
                                <div class="question-number">${q.number}</div>
                                <h4>${q.question || `Question ${q.number}`}</h4>
                                <div class="status-badge status-${statusClass}">${statusText}</div>
                            </div>
                            
                            <div class="solution-section">
                                <h4>üìù Student's Solution</h4>
                                <div class="solution-content">${formatMath(q.student_answer)}</div>
                            </div>
                            
                            ${q.error ? `
                                <div class="solution-section">
                                    <h4>‚ö†Ô∏è Error Analysis</h4>
                                    <div class="solution-content">${q.error}</div>
                                </div>
                            ` : ''}
                            
                            <div class="solution-section">
                                <h4>‚úÖ Corrected Solution</h4>
                                <div class="solution-content">${formatMath(q.correction)}</div>
                            </div>
                        </div>
                    `;
                });
            } else {
                html += '<p>No questions found in the uploaded files.</p>';
            }
            
            // Action buttons
            html += '<div class="action-buttons">';
            
            if (data.corrected_images && data.corrected_images.length > 0) {
                html += `<button class="btn btn-primary" onclick="showCorrectedPaper()">
                    üìê View Corrected Paper
                </button>`;
            }
            
            html += `<button class="btn btn-secondary" onclick="generatePractice()">
                üìù Generate Practice Paper
            </button>`;
            
            html += '</div></div>';
            
            container.innerHTML = html;
            
            // Render MathJax
            if (window.MathJax) {
                MathJax.typesetPromise([container]).catch(err => {
                    console.error('MathJax error:', err);
                });
            }
        }
        
        function formatMath(text) {
            if (!text) return '';
            // Convert line breaks to <br> and ensure proper spacing
            return text.split('\n').map(line => {
                // Check if line contains math
                if (line.includes('$')) {
                    return line;
                }
                // Add $ around numbers and variables for simple math
                return line.replace(/(\d+[xXyYzZ]|[xXyYzZ]\d+)/g, '$$1$');
            }).join('<br>');
        }
        
        // Modal Functions
        function showCorrectedPaper() {
            // This would fetch corrected images from current analysis
            // For now, show placeholder
            document.getElementById('correctedImages').innerHTML = `
                <img src="https://via.placeholder.com/400x600/FF0000/FFFFFF?text=Corrected+Paper+with+Boxes" 
                     class="corrected-image">
                <p>Error boxes show exact mistakes in student's work.</p>
            `;
            document.getElementById('correctedModal').classList.add('active');
        }
        
        async function generatePractice() {
            try {
                const response = await fetch(`${BACKEND_URL}/api/generate-practice`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({questions: []}), // Would send actual questions
                    credentials: 'include'
                });
                
                const data = await response.json();
                
                let html = '<div class="practice-paper">';
                html += '<h4>Practice Paper</h4>';
                
                if (data.practice && data.practice.length > 0) {
                    data.practice.forEach((q, idx) => {
                        html += `
                            <div style="margin-bottom: 1rem; padding: 1rem; background: #f8f9fa; border-radius: 0.5rem;">
                                <strong>Question ${q.number}:</strong> ${q.question}
                            </div>
                        `;
                    });
                } else {
                    html += '<p>No practice questions generated.</p>';
                }
                
                html += '</div>';
                
                document.getElementById('practiceContent').innerHTML = html;
                document.getElementById('practiceModal').classList.add('active');
                
            } catch (error) {
                alert('Failed to generate practice paper');
            }
        }
        
        function downloadPractice() {
            // Simple PDF generation
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF();
            
            pdf.setFontSize(20);
            pdf.text('MathGPT Practice Paper', 20, 20);
            
            pdf.setFontSize(12);
            pdf.text('Generated for your improvement', 20, 30);
            
            pdf.save('practice-paper.pdf');
        }
        
        function closeModal() {
            document.getElementById('correctedModal').classList.remove('active');
            document.getElementById('practiceModal').classList.remove('active');
        }
    </script>
</body>
</html>
